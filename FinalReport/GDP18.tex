%% ----------------------------------------------------------------
%% GDP.tex
%% ---------------------------------------------------------------- 
\documentclass[oneside]{ecsgdp}         % Use the GDP Report Style
\graphicspath{{../Figures/}}   % Location of your graphics files
\usepackage[numbers]{natbib}            % Use Natbib style for the refs.
\hypersetup{colorlinks=true}   % Set to false for black/white printing
%% ----------------------------------------------------------------
\begin{document}
\frontmatter
\title      {Unmanned Aircraft Camera Module \\(GDP Group 18)}
\authors{ \href{mailto:ajb2g08@ecs.soton.ac.uk}{Andy Busse},
             \\ \href{mailto:jgac1g08@ecs.soton.ac.uk}{John Charlesworth},
             \\ \href{mailto:mh23g08@ecs.soton.ac.uk}{Michael Hodgson},
             \\ \href{mailto:ps26g08@ecs.soton.ac.uk}{Piyabhum Sornpaisarn},
             \\ \href{mailto:ps6g08@ecs.soton.ac.uk}{Paramithi Svastisinha}
	    }
\date       {\today}
\subject    {ELEC6050 Group Design Project}
\keywords   {GDP 18 Group Design Project Camera Interface Software Hardware JPEG Electronic Engineering}
\supervisor {Dr. Rob Maunder}
\examiner   {Dr. Jeff Reeve}
\degree     {Master of Electronic Engineering}
\maketitle
%% ----------------------------------------------------------------
\begin{abstract}
Given an autopilot module for an unmanned aircraft vehicule (UAV), a camera module was designed, built, and tested to be able to capture still images and transmit them to a ground station through the autopilot module's serial link. The systems described include... (42/200 words so far)
\end{abstract}
%% ----------------------------------------------------------------
\tableofcontents
\listoffigures
\listoftables
\lstlistoflistings
\listofsymbols{ll}{$w$ & weight vector}
\mainmatter

%% ----------------------------------------------------------------
\chapter{Introduction}
%% ----------------------------------------------------------------
Introduction goes here...


%% ----------------------------------------------------------------
\chapter{Background Research}
%% ----------------------------------------------------------------

\section{JPEG Image Compression}
The images obtained from the camera will be in the JPEG image format. If the image data is sent to the ground station progressively, it must be necessary to understand how a JPEG image is structured to reconstruct the encoded image. Unlike raw image data, which can easily be read continuously, JPEG files have already been compressed and contain information which must first be read to properly decompress the image.

\subsection{JPEG structure}
A JPEG file can be separated into two main parts. The first part of the JPEG file is composed of segments containing information concerning various properties of the image which must be read in order to recover the image from its compressed form. The second part contains the entropy-encoded image data, which can be decoded using the information provided from the headers of the file.  

The segments which make up the image file properties are indicated by header markers. ``Each marker is immediately preceded by an all 1 byte (0xff).'' (Header guide) This marker is then followed by a marker identifier byte specific to that segment type. The 0xff value will always indicates the start of the header in this part, but is treated differently in the image data stream. ``If a 0xff byte occurs in the compressed image data either a zero byte (0x00) or a marker identifier follows it.'' (Header guide) 0xff bytes followed by a zero byte are read in as the hexadecimal value 0xff and the 0x00 byte is ignored entirely. 0xff bytes not following this a 0x00 byte are considered to be the header byte of the next segment. If the segment contains useful information before the next marker identifier, it is then followed by two bytes specifying the total length of the segment (in bytes). For the SOS segment, this does not include the entropy-encoded image data.

\subsubsection{JPEG Segments}
The number of headers found within a JPEG image file is not constant between images. The JPEG headers are capable of storing most of the metadata related to an image, not all of which is necessary for the decompression of the image. The following headers are those which contain all the information necessary for a successful decompression of the JPEG image, as well as those which can be found in all JPEG images. The number in brackets next to the segment name is the unique marker identifier value which appears directly after the 0xff marker indicator byte. All numerical values obtained from the byte stream are unsigned. ``DQT, DHT, DRI and SOF may line up in any order, but must be recorded after APP1 (or APP2 if any) and before SOS.'' (Exif)

\paragraph*{SOI: Start Of Image (0xd8)}
This header identifies the start of the image and can be found in all JPEG images. This is the first header to be read in a JPEG file. This header does not contain any information to be stored by the decompression algorithm, but can be useful for differenciating multiple JPEG images from a single data stream.

\paragraph*{APP0: JFIF application segment (0xe0)}
There can be many APP segments in a single image. Subsequent APP segments are named ``APP\emph{n}'' with a marker identifier of 0xe\emph{n} with \emph{n} being the number of the APP segment. This segment does not contain any information necessary to the decompression algorithm used, so all APP segments ignored.

\paragraph*{SOF0: Start Of Frame (0xc0)}
``SOF is a marker code indicating the start of a frame segment and giving various parameters for that frame'' (Header guide) /this indicates that the image is a ``DCT-based JPEG, and specifies the width, height, number of components, and component subsampling (e.g., 4:2:0)'' as well as the data precision (in bits/sample) of an image. (narcap) From the component subsampling information, the size of the Minimum Coded Unit (MCU) which make up the JPEG image. Just like the APP segments, there can be multiple start of frame segments in more complex images, but the images sent by the camera will only need the information contained in the first SOF segment.

\paragraph*{DHT: Define Huffman Table(s) (0xc4)}
This segment defines the properties of one or many Huffman table(s) (HT) which will be used to decode the entropy-encoded image data. ``A single DHT segment may contain multiple HTs, each with its own information byte.'' This segment includes the number of the HT as identified by the image data and the type of the HT (either DC or AC) It also stores the ''number of symbols with codes of length 1..16, the sum (n) of these bytes is the total number of codes, which must be $\leq$ 256'' as well as ``the symbols in order of increasing code length ( n = total number of codes )'' (Header guide). In practice, a single image can also contain multiple DHT segments which all share the same marker identifier. 

\paragraph*{DQT: Define Quantization Table(s) (0xdb)}
This segment defines the properties of one or many quantization table(s).

\paragraph*{SOS: Start Of Scan (0xda)}
This segment gives various scan-related parameters and is the last segment preceding the entropy-encoded image data. This segment associates each component in the scan with the appropriate AC and DC Huffman table by their ID number. 3 ignorable bytes seperate this segment from the image data. 

\paragraph*{EOI: End Of Image (0xd9)}
This header identifies the end of the image. ''It is possible that the end of the image is reached without finding the EOI marker. In this case, the image is technically malformed but the situation is tolerated and handled as if the EOI marker was found.`` (winzip) 

\subsubsection{Entropy-encoded image data}
(Exif)

\subsection{JPEG Header Information Extractor}

\subsection{Progressive Display of Image}

\section{Existing Hardware and Software}
Research concerning the payload and the associated software goes here...

\section{Cameras Available}

%\section{Hardware Selection}
%Research justifying hardware choice goes here...


%% ----------------------------------------------------------------
\chapter{Specification}
%% ----------------------------------------------------------------

\section{Proposed Brief}
The original agreed project specification and plan, handed in on the first week of the project, was to design, build, and test an electronic module capable of capturing still images from an unmanned aerial vehicle (UAV) and transmitting the images to a ground station. The module must use the UAV autopilot’s low-bandwidth RS485 serial link (38.4 kBaud). A program must be written to interface with the base station software over a TCP/IP link, allowing image data to be received and then displayed to the user. The electronic module would be constructed using strip-boards and would later be implemented on PCB if time is available.


\section{Objectives} 
The aim of the project was to achieve the following criteria, which were also prioritized in order to ensure organized and efficient work: (maybe add some justification to the why things were certain priorities?)


\begin{itemize}
	\item The image would be encoded in such a way that a low quality image will be available quickly, the quality of which would improve as more information is downloaded. [high priority]
	\item Minimise the time needed to download the images from the UAV to the base station. The time from the user’s prompt until the image has been fully downloaded will be measured against the theoretical 3 minutes necessary to transmit a full image without using any compression. The goal will be to obtain a full image in \textbf{less than 3 minutes.} [high priority]
	\item The module weight will be\textbf{less than 250g}. [medium priority]
	\item Image resolution of \textbf{640x480}. [medium priority]
	\item Allow the user to perform the following actions on the UAV’s camera from the base station:
	\begin{itemize}
		\item Prompt the UAV to \textbf{capture and download an image}. [high priority]
		\item \textbf{Cancel} the downloading of any image while the image is being downloaded. [medium priority]
		\item \textbf{Resend} an image in case the current preview is corrupted. [low priority]
		\item \textbf{Interrupt} the download of an incomplete image and allow the user to save the incomplete image. [low priority]
		\item Select the \textbf{resolution settings} of the image. [low priority]
		\item Display a progress indicator which will show the percentage of the image datareceived, as well as a time estimate for the rest of the image to be downloaded. [low priority]
		\item The image capture will be triggered automatically by the UAV using triggers built into the autopilot. [low priority]
		\item Allow the user to command the image capture to \textbf{trigger periodically} over a \textbf{userspecified time interval} will be added if time permits. [low priority]
	\end{itemize}
	\item Images will be transmitted in \textbf{colour} as opposed to black and white. [low priority]
	\item The user can select between a colour image and a black and white. [low priority]
\end{itemize}


\section{Deliverables}
The deliverables which were planned to be produced by the end of the project to the customer include:
\begin{itemize}
	\item \underline{Hardware}: Camera module, constructed on PCB (if time permits, otherwise on strip-board),including layout designs.
	\item \underline{Software}: All firmware for the electronic module, and software on the base station for viewing images. The full source code and all executable files will be included.
	\item \underline{Documentation}: Technical and User Documentation. This includes all schematics related to hardware as well as all other documents concerning both the software and hardware delivered.
	\item \underline{Public repository}: The full source code, all schematics, and all documents concerning both the software and hardware will be included on a public repository so that the client may share this information with his clients.
\end{itemize}

%% ----------------------------------------------------------------
\chapter{Design Approaches Considered}
%% ----------------------------------------------------------------

\section{Payload Image Capture}

\subsection{Camera Module}
John

\subsubsection{Approach: Analogue Camera}
Short description of the approach

Advantages:
\begin{itemize}
\item Blah
\item Blah
\end{itemize}

Disadvantages:
\begin{itemize}
\item Blah
\item Blah
\end{itemize}

Conclusion of approach

\subsubsection{Approach: Serial Camera}

\subsubsection{Approach: USB Camera}


\subsection{Image Buffering}
Andy

\subsubsection{Approach: Flash Chip}

\subsubsection{Approach: SD Card}

\subsubsection{Approach: SRAM}
Or whatever it is called

\section{Payload Controller}
IMAGE OF PAYLOAD CONTROLLER BLOCK?

\subsection{Payload Controller Hardware}
The hardware used to implement the payload controller is an important consideration.

The exact requirements for this module depend on other design decisions made, such as the method used to interface with the camera module. However there are a certain fixed set of requirements derived from the specification:
\begin{itemize}
\item The module must communicate with the autopilot over an asynchronous RS-485 serial connection at 36 kbaud. This suggests that the module should have access to some form of UART.
\end{itemize}

Additional requirements depend on other design decisions:
\begin{itemize}
\item \emph{Camera communication:} Using a serial camera would mean the controller requiring access to another UART, while using a USB camera leaves the camera needing access to a USB host interface. Similarly using an analogue camera would mean either the controller be capable of digitising the camera data itself or having a method of interfacing with an external digitiser.

\item \emph{Image buffering:} Most embedded systems do not have enough RAM or Flash to store a reasonable sized image on onboard memory. As described in section |||||| BUFFERING ||||||, there are a number of approaches worth considering for externally buffering an input image, however these do require the controller to have an interface with which to communicate with the external memory.

\item \emph{Progressive JPEG Manipulation:} Section |||||| PROGRESSIVE JPEG MANIPULATION ||||| details several ways progressive JPEG manipulation could be tackled. Depending on the design choice taken this could influence the requirements of the controller substantially. Examples of such requirements could be: extra processing power, fast access to memory or FFT or DFT libraries being available for the device.
\end{itemize}

\subsubsection{Approach: Digital Signal Processor (DSP) Development Board}
An appropriate Digital Signal Processor (DSP) development board would provide fast digital signal processing capabilities to the controller. This would be especially useful for the situations mentioned in section |||||| PROGRESSIVE JPEG MANIPULATION |||||.

Since DSP chips tend to be specialist devices they are usually difficult to set up or program without first experimenting with the design using a development board - a special board designed with experimentation and product development in mind. Ideally a development board would be used for initial development of the system with a integrated PCB being developed later on to allow the DSP to be used on its own.

Advantages:
\begin{itemize}
\item DSPs often have very good analogue to digital conversion built in as standard. If an analogue camera is used (as discussed in section ||||| ANALOUGE CAMERA |||||) a DSP may provide the necessary fast ADC without any extra components.

\item Libraries for tasks such Fast Fourier Transforms or other signal and image processing related applications are often readily available for DSP chips. For some methods of performing progressive JPEG manipulation (see section |||||| PROGRESSIVE JPEG MANIPULATION |||||) this could be useful.

\item Large number of miscellaneous signal processing related hardware features built in which could be useful in as-yet unforeseen circumstances.
\end{itemize}

Disadvantages:
\begin{itemize}
\item DSP chips are often complex and may require significant work to produce a system running without a development board.

\item DSP development boards often cannot be used effectively in a final version of a project due to size and power constraints.
\end{itemize}


DSP boards are a specialist tool, which could be especially useful - if not required - if implementing certain image processing algorithms such as some of those detailed in section |||||| PROGRESSIVE JPEG MANIPULATION |||||. The downside of this is a more complex overall system.

\subsubsection{Approach: Atmel 8-bit AVR}
\label{sec:desappr:avr}
The Atmel 8-bit AVR family is a well-known set of low cost, single chip microcontrollers. Specific parameters taken from \cite{megaAVR_parameters}.

Advantages:
\begin{itemize}
\item All members of our group have had experience working with AVR chips.

\item Programming and debugging devices are readily available to us.

\item Creating stand-alone systems easy: no need for large amounts of additional components.

\item Commonly used devices mean large community built around the device family meaning support and additional libraries are more likely to be available.

\item Some initial payload code available to us already implemented on a AVR.

\item Large range of different devices which work with the same programming tools and minimal code changes available.

\item Many through-hole versions of the devices are available, making prototyping significantly easier (and cheaper, due to lack of need for breakout boards) than using surface mount components.
\end{itemize}

Disadvantages:
\begin{itemize}
\item Most 8-bit AVR devices are reasonably low speed (20MHz maximum), meaning they could be unsuitable for heavy calculations such as image processing.

\item 8-bit AVRs do not have floating point processing units, making some image processing tasks much slower to complete on an AVR.

\item Less communication options than some other, more complex, devices. This limits the number of peripheral devices that can be connected to the controller at once, and so may reduce flexibility.

\item Limited RAM available on the commonly used devices which are available in through-hole format. A common amount of RAM for a larger through-hole AVR is 4 kbytes.

\item The smaller, cheaper, devices have reasonably limited program memory, with 64 kbytes being a typical amount for a larger through-hole device. This could be a problem if implementing large amounts of code or using significant numbers of lookup tables for example.
\end{itemize}

AVRs are robust, widely used, general purpose microcontrollers. The large community surrounding them is a particular advantage, as it means many libraries and development boards are available for the devices. Our previous experience with the devices is also a key advantage, although it is important to be aware of the devices limits.


\subsubsection{Approach: Atmel 8-bit AVR with Arduino Prototyping Platform}

The Arduino platform is a low cost, open-source development platform for the Atmel AVR microcontroller family. The latest versions of the development platform consists of an ATMega328 microcontroller along with voltage regulators, inbuilt USB programmer and serial interface and 16MHz crystal. A software library for the device provides a wrapper around many of the complexities of the AVR platform, allowing more rapid development to be possible than with a pure AVR. A simple IDE is used to program the device and a wide range of extra libraries are available which target the platform.

The advantages and disadvantages of the Atmel 8-bit AVRs mentioned in section \ref{sec:desappr:avr} also apply.

Advantages:
\begin{itemize}
\item Just an ATMega328 'under the hood' meaning that the additional power of the chip can be leveraged if needed.

\item Many common tasks such as setting the baud rate of the serial link are made very simple by the Arduino libraries, meaning development time can be spent working on more challenging features.

\item Very widely used by hobbyists, meaning a large number of open-source libraries are available for the platform.

\end{itemize}

Disadvantages:
\begin{itemize}
\item Using the Arduino libraries means a certain amount of unused overhead is likely.

\item The Arduino libraries hide much of the complexity of the device. This can mean advanced features are hidden or not exposed, negating some of the advantages of the library when advanced features are needed.

\end{itemize}

\subsubsection{Approach: Arduino with Multiplexed Serial}

\subsubsection{Approach: Arduino with Dual Controllers}


\subsection{Payload/Ground Station Interaction}
Michael


\section{Ground Station Image Viewer}
Peak

\section{Progressive JPEG Manipulation}
Mitch

\section{Physical Implementation}
Andy

\subsection{Power Source}

\subsubsection{Approach: Battery Powered}

\subsubsection{Approach: Autopilot Powered}

%% ----------------------------------------------------------------
\chapter{Chosen Design Approaches}
%% ----------------------------------------------------------------


\section{Payload Image Capture}

\section{Payload/Ground Station Interaction}

\section{Ground Station Image Viewer}

\section{Progressive JPEG Manipulation}

\section{Physical Implementation}
Andy

%% ----------------------------------------------------------------
\chapter{Implementation}
%% ----------------------------------------------------------------


\section{Payload Image Capture}

\section{Payload Controller}

\section{Ground Station Image Viewer}

\section{Progressive JPEG Manipulation}

\section{Physical Implementation}

\section{System Integration}


%% ----------------------------------------------------------------
\chapter{Overview}
%% ----------------------------------------------------------------
An overview of the entire project process goes here...

\section{Final Deliverables}
The final deliverables of the project are described here...

\section{Evaluation Against Specification}


%% ----------------------------------------------------------------
\chapter{Testing}
%% ----------------------------------------------------------------

\subsection{Camera/Payload Interaction}

\subsection{SD Card/Payload Interaction}

\subsection{Payload/Ground Station Interaction}

\subsection{Ground Station Image Viewer}

\subsection{Progressive JPEG Manipulation}

%% ----------------------------------------------------------------
\chapter{Project Management}
%% ----------------------------------------------------------------
Project management goes here...

\section{Gantt Charts}
Michael
Place Gantt charts here.

\section{Risk Management}
Mitch
Place risk management considerations and compare with risks encountered.

\section{Work Allocation}
Peak
Talk about planned work allocation to be compared with actual work allocation. Reflect on efficiency.

\subsection{Planned Work Allocation}
Talk about the tasks planned and the skills audit.

\subsection{Actual Task Allocation}
Talk about who did what in the end and how tasks were passed around. How did people work together?

\section{Team Resources}
John
What we used to get the job done...

\subsection{Budget}
What did we need to buy in the end?

\subsection{Electronic Material}
Did we make use of anything electronic that we had before the project?

\section{Group Communication}
Andy
Talk about how the group contacted each other (email, meetings, mobiles)...

\subsection{Formal Meetings}
Talk about the usefulness and benefit of the formal Tuesday meetings...

\subsection{Methods of Communication}
Talk about which methods were used more often, which were useful...

\subsection{Software Management}
How we used e-mails, SVN Tortoise, and Github to keep our progress safe...


%% ----------------------------------------------------------------
\chapter{Future work}
%% ----------------------------------------------------------------
Future work goes here. May be combined with the Evaluation section.

%% ----------------------------------------------------------------
\chapter{Evaluation}
%% ----------------------------------------------------------------

\section{Success}
Discuss how successful the final project is in terms of meeting the project brief goals...

\section{Team}
Discuss how successful the team functioned as a whole? Well communicated? Tasks properly assigned? Sufficient work done?

%% ----------------------------------------------------------------
\chapter{Conclusions}
%% ----------------------------------------------------------------
Conclusions go here.

%% ----------------------------------------------------------------
\chapter{Documentation}
%% ----------------------------------------------------------------
Mitch
All supplementary documentation prepared for the project can be referenced here...

%% ----------------------------------------------------------------
\acknowledgements{I would like to thank...}
\dedicatory{To \dots}

%% ----------------------------------------------------------------
\include{Introduction}
\include{Conclusions}
\appendix
\backmatter
\chapter{Glossary}

\section*{Terms} 
\begin{description}
	\item[YCbCr] Colour space used to represent JPEG images. Composed of three values:
		\begin{description}
			\item[Y] luma component.
			\item[Cb] blue-difference chroma component.
			\item[Cr] red-difference chroma component.
		\end{description}
	\item[4:x:y]Chroma subsampling notation.
		\begin{description}
			\item[4] Luma horizontal (and vertical) sampling reference.
			\item[x] Cb and Cr horizontal sampling factor.
			\item[y] Cb and Cr horizontal sampling factor. If 0, indicates 2:1 vertical subsampling for both Cb and Cr.
		\end{description}
\end{description}

\section*{Abbreviations} 
\begin{description}
	\item[AC] Alternating Current 
	\item[DC] Digital Current 
	\item[JPEG] Joint Photographic Experts Group, creators of the jpeg compression method. Used interchangeably with the jpeg image type.
	\item[EXIF] EXchangeable Image File format for digital still cameras.
	\item[MCU] Minimum Coded Unit
	\item[DFT] Discrete Fourier Transform
	\item[FFT] Fast Fourier Transform
	\item[DCT] Discrete Cosine Transform
	\item[WHT] Walsh–Hadamard Transform
	\item[KLT] Karhunen-Lo\`eve Transform
	\item[SOI] Start Of Image
	\item[SOF] Start Of Frame
	\item[DHT] Define Huffman Table(s)
	\item[HT] Huffman Table
	\item[DQT] Define Quantization Table(s)
	\item[QT] Quantization Table
	\item[SOS] Start Of Scan
	\item[EOI] End Of Image
	\item[SD card]
\end{description}
\chapter{Appendix A}

\bibliographystyle{ecs}

\begin{thebibliography}{9}

	\bibitem{tortorella_jpeg_enc} Tortorella, Richard. \emph{Image Doctoring: JPEG Encoding and Analysis}. Rep. NARCAP, May 2009. Web. 11 Oct. 2011. \url{http://www.narcap.org/reports/narcap_IR-01_DigHoaxing.pdf}.
	
	\bibitem{exif_std} Japan Electronics and Information Technology Industries Association (JEITA). \emph{Digital Still Camera Image File Format Standard (Exchangeable Image File Format for Digital Still Cameras: Exif)} Version 2.1. Tech. Japan Electronic Industry Development Association (JEIDA), 12 June 1998. Web. 14 Oct. 2011 \url{http://www.exif.org/Exif2-1.PDF}.
	
	\bibitem{netravali_digital_repr} Netravali, Arun N., and Barry G. Haskell. \emph{Digital Pictures: Representation and Compression}. New York: Plenum, 1988. Print. 
	
	\bibitem{jpeg_layout} \emph{JPEG File Layout and Format}. Original URL: \\http://www.funducode.com/freec/Fileformats/format3/format3b.htm (defunct).\\DCube Software Technologies, 5 July 2002. Web. 28 Oct. 2011. \url{http://class.ee.iastate.edu/ee528/Reading%20material/JPEG_File_Format.pdf}
	
	\bibitem{winzip_jpeg_compression} WinZip® International LLC. \emph{JPEG Compression}. Tech. Version 1.0. 11 Sept. 2008. Web. 28 Oct. 2011. \url{http://www.winzip.com/wz_jpg_comp.pdf}.
	
	\bibitem{poynton_chroma_subsampling} Poynton, Charles. \emph{Chroma Subsampling Notation.} Charles Poynton. 24 Jan. 2008. Web. 31 Oct. 2011. \url{http://poynton.com/PDFs/Chroma_subsampling_notation.pdf}.
	
	\bibitem{kerr_chroma_subsampling} Kerr, Douglas A. \emph{Chrominance Subsampling in Digital Images}. Rep. Issue 2. 3 Dec. 2009. Web. 31 Oct. 2011. \url{http://dougkerr.net/pumpkin/articles/Subsampling.pdf}.
	
	\bibitem{hass_impulse_jpeg} Hass, Calvin. \emph{ImpulseAdventure - Digital Photography Articles.} 2008. Web. 22 Nov. 2011. \url{http://www.impulseadventure.com/photo/}.
	
	\bibitem{megaAVR_parameters} \emph{Atmel - megaAVR Parameters.} Web. 07 Dec 2011. \url{http://www.atmel.com/dyn/products/param_table.asp?category_id=163&family_id=607&subfamily_id=760}

\end{thebibliography}
\end{document}
%% ----------------------------------------------------------------
